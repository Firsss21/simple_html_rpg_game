
### **Название:**

Простая HTML5 online rpg игра.
[Ссылка](http://109.174.56.141:5301/login)

• Онлайн HTML5 RPG игра, с CRUD элементом и с минимальным использованием фреймворков, написанная на Java с использованием сервлетов, развернутая с помощью TomCat на персональном компьютере.
• База данных установлена и настроена на виртуальной машине на том же персональном компьютере. 
(В связи с ремонтом, может не быть электричества и соотвественно сервера в какие-то часы/дни)

-----

### **Технологии:**

•	База данных MySql.

•	JSP.

•	JBDC.

•	HTML/CSS.

•	Servlets.

•	Maven.

-----

### **Описание:**

При входе в игру предлагается авторизоваться используя имя и пароль:

    •   Если игрок с таким именем и паролем есть, то игрока авторизует;

    •   Если игрока нет, то он создается с параметрами урон 10, жизни 100;

    •   Если игрок есть, но пароль не совпал – выдать ошибку

После авторизации игрок попадает на главную страницу с таким меню:

    •   Поиск соперника – переход на страницу ожидания противника.

    •   Выход – закрытие сессии и переход на страницу входа

1. После нажатия на кнопку, игрок помечается, как готовый к дуэли и ему в противники подбирается другой игрок с таким же статусом “готовый к дуэли”.

2. После того как оба игрока найдены, каждый видит своего врага и таймер 30 сек до начала битвы.

3. По истечении таймера начинается битва. Здесь игрок видит параметры своего противника – имя, жизни (прогресс бар), урон и кнопку Атаковать, а также свои параметры в отдельном блоке.

        •	По окончании дуэли победитель получает +1 рейтинга, проигравший получает -1 рейтинга. Независимо от победы или проигрыша каждый игрок получает +1 к параметру урон и +1 к параметру жизни.

        •	Выведен лог боя на странице боя.

Внизу каждой страницы выведена такая техническая информация, как: 

      •	Время генерации страницы в миллисекундах

      •	Количество запросов пользователем в базу данных и время их выполнения.


-----

### **Демо:**

Страница авторизации

![](https://i.imgur.com/EpIaAHC.png)

Главное меню

![](https://i.imgur.com/sm5pM93.png)
 
Страница ожидания соперника

![](https://i.imgur.com/9AVunyv.png)
 
Отсчет до боя, после нашедшегося соперника

![](https://i.imgur.com/xjAYm0Z.png)
 
Страница боя:

![](https://i.imgur.com/xhUgEzV.png)

Окно награды (потенциальное)

![](https://i.imgur.com/WBqx2fJ.png)

![](https://i.imgur.com/nykF0i5.png)
 
Изменение статистики

![](https://i.imgur.com/I0PND8U.png)

![](https://i.imgur.com/Azz5guf.png)

MySql

![](https://i.imgur.com/hnlKzt7.png)

Таблицы:

Players

![](https://i.imgur.com/3RY9pb5.png)

Users

![](https://i.imgur.com/QTqz2wY.png)


 

 
-----

### **Развертывание проекта:**

• С помощью `maven` плагина собирался `war` файл и развертывался в `tomcat`

    Tomcat7:run-war
    
    <plugin>
        <groupId>org.apache.tomcat.maven</groupId>
        <artifactId>tomcat7-maven-plugin</artifactId>
        <version>2.2</version>
        <configuration>
            <port>5301</port>
            <path>/</path>
            <contextFile>src/main/webapp/WEB-INF/web.xml</contextFile>
            <mode>context</mode>
            <charset>UTF-8</charset>
            <warDirectory>target/${project.artifactId}-${project.version}</warDirectory>
        </configuration>
    </plugin>

• База данных установлена на виртуальной машине, созданной через VirtualBox, на которой установлен Ubuntu 19.10
• Для доступа в глобальную сеть был настроен проброс портов в роутере.

-----

### **Документация классов:**

• Класс Main отвечает за инициализацию статических данных –
Время для таймера, коллекцию всех игроков, которые подключаются, количество совершенных соединений с бд каждым пользователем и общее время их выполнения.

      public static final long WAITING_TIME_BEFORE_FIGHT = 30 * 1000;

      public static final Map<String, Player> PLAYERS = new ConcurrentHashMap<>();

      public static int CONNECTIONS_CREATED = 0;

      public static int TOTAL_CONNECTION_TIME = 0;


###
 
#### Пакет **dao (data access object)** отвечает за предоставления механизма управления взаимодействия с базой данных для различных сущностей.

Состоит из интерфейса Dao, реализующего его абстрактного класса, в котором определены его методы и расширяющие его классы, которые используют абстрактный класс для определенных сущностей, в моем Player, User.

• **Интерфейс:**

    `public interface Dao<T> {

        T get(int key);

        List<T> getAll();

        boolean exist(int key);

        void save(T t);

        void update(T t);

        void delete(T t);
    }`
 
 ###

#### Пакет **models** отвечает за представление сущностей игрока и пользователя (в этой программе User используется для аутентификации, а Player для создания бойца/игрока/персонажа, с расчетом на то, что может быть несколько бойцов у одного пользователя)
 
Основные поля данных User и Player: 

    `public class User {
        private int id = -1;
        private String name;
        private String password;`

      `public class Player {

          // tech

          private int id;
          private boolean inBattle;
          public Battle battle = null;
          public final Set<HttpSession> clientSessions = Collections.synchronizedSet(new HashSet<>());

          // params

          private String name;
          private int healthPoints;
          private int attackRate;
          private int tempHp;
          // statistic

          private int elo;`

В основном в этих классах есть только getter’ы и setter’ы для этих данных.

###

#### Пакет **Utils** предоставляет различные инструменты, такие как: 
• фабрика создания сессий с базой данных (синглтон) 
• Md5 шифрование
• Класс с конфигом подключения к базе данных, скрытый из репозитория
• CustomExecutor, созданный для выполнения различных runnable команд с задержкой, но так и не пригодившийся.
• Класс Authentication, помогающий с авторизацией при проверке данных пользователя  

###

#### Пакет **matchmaker**, отвечающий за создание и завершение боев, состоит из двух классов: Battle, FightManager.

• FightManager отвечает за создание боев и содержит в себе synchronized список боев, в котором есть только один метод – регистрации игрока в бой.
• Battle отвечает за бой, атаки, награды, завершение и старт боев.

###

#### Пакет **servlets** отвечает за сервлеты приложения и содержит в себе логику перемещения по страницам, взаимодействия с кнопками, с помощью единственного фильтра игрока происходит защита от несанкционированного доступа пользователя к страницам, редиректу на нужные страницы, такие как: бой, экран награды.

###

#### Пакет **webApp** отвечает за визуальную часть программы, в нем описываются все JSP элементы, CSS, изображения. 

-----

### **Основная логика приложения:**

• Пользователь заходит на сайт, ему предоставляется доступ к авторизации, он либо логинится, либо создает нового пользователя, который сохраняется в базу данных, после чего выбирает следующий шаг – деавторизация пользователя или поиск боя. 

• В случае деавторизации его сессия закрывается и его перекидывает на страницу авторизации. В случае поиска боя – создается новый экземпляр боя, и пользователь ожидает соперника на странице ожидания. 

• Каждую секунду страница обновляется и проверяется на то, не нашелся ли соперник. Когда второй пользователь становится в очередь - обоих перекидывает на страницу с таймером начала боя (реализовано через обновление страницы). 

• После старта боя – страница обновляется каждую секунду, а так же при атаке.

• Когда бой завершается – характеристики из бойцов изменяются и обоих перекидывает на страницу с наградой (завершение боя), из которой у них есть выход в главное меню. 

-----

### **Проблемы, с которыми пришлось столкнутся:**

• Редирект различных пользователей при изменении атрибутов различных сессий, динамическое отслеживание изменений (пример подходящего решения: вебсокеты).

-----

### **Что можно было бы добавить и можно дополнить / баги:**

• Фабрику DAO для различных сущностей.

• Улучшить верстку

• Добавить управление зависимостями в DAO

• Во время боя или таймера до боя слетает CSS.

• Разделить фильтры для сервлетов на несколько.

• Методы для сохранения сущностей в самих этих моделях.

-----

### **Листинг:**
  
  <https://github.com/Firsss21/simple_html5_rpg_game>
